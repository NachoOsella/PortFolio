@if (isLoading()) {
    <section class="mx-auto max-w-4xl px-6 py-20">
        <div class="animate-pulse space-y-8">
            <div class="h-8 w-32 rounded bg-[#18181b]"></div>
            <div class="h-12 w-3/4 rounded bg-[#18181b]"></div>
            <div class="h-6 w-1/2 rounded bg-[#18181b]"></div>
            <div class="aspect-video rounded-lg bg-[#18181b]"></div>
            <div class="space-y-4">
                <div class="h-4 w-full rounded bg-[#18181b]"></div>
                <div class="h-4 w-5/6 rounded bg-[#18181b]"></div>
                <div class="h-4 w-4/6 rounded bg-[#18181b]"></div>
            </div>
        </div>
    </section>
} @else if (error()) {
    <section class="mx-auto max-w-4xl px-6 py-20 text-center">
        <div class="rounded-lg border border-red-500/20 bg-red-500/10 p-12">
            <p class="text-red-400">{{ error() }}</p>
            <a routerLink="/blog" class="mt-4 inline-flex h-10 items-center gap-2 rounded-md border border-white/10 px-5 text-sm font-medium text-[#a1a1aa] transition-colors hover:border-white/20 hover:text-[#fafafa]">
                <lucide-icon [img]="icons.ArrowLeft" [size]="16" />
                Back to Blog
            </a>
        </div>
    </section>
} @else if (post()) {
    <article class="mx-auto max-w-4xl px-6 py-20">
        <a
            routerLink="/blog"
            class="inline-flex h-10 items-center gap-2 rounded-md border border-white/10 px-4 text-sm font-medium text-[#71717a] transition-colors hover:border-white/20 hover:text-[#fafafa]"
        >
            <lucide-icon [img]="icons.ArrowLeft" [size]="16" />
            Back to Blog
        </a>

        <header class="mt-8">
            <h1 class="text-3xl font-semibold tracking-tight text-[#fafafa] sm:text-4xl lg:text-5xl">
                {{ post()!.title }}
            </h1>

            <div class="mt-4 flex flex-wrap items-center gap-4 text-sm text-[#71717a]">
                <time [attr.datetime]="post()!.date">{{ post()!.date | date: 'mediumDate' }}</time>
                <span class="text-[#52525b]">·</span>
                <span>{{ post()!.readingTime }}</span>
            </div>

            <div class="mt-4 flex flex-wrap gap-2">
                @for (tag of post()!.tags; track tag) {
                    <span class="rounded bg-white/[0.03] px-2.5 py-1 text-xs font-medium text-[#71717a]">
                        {{ tag }}
                    </span>
                }
            </div>
        </header>

        @if (post()!.coverImage) {
            <div class="mt-8 aspect-video overflow-hidden rounded-lg border border-white/[0.06] bg-[#18181b]">
                <img
                    [src]="post()!.coverImage"
                    [alt]="post()!.title"
                    class="h-full w-full object-cover"
                />
            </div>
        }

            @if (post()!.toc && post()!.toc!.length > 0) {
            <div class="mt-8 lg:hidden">
                <button
                    (click)="toggleToc()"
                    class="flex w-full items-center justify-between rounded-lg border border-white/[0.06] bg-[#18181b] p-4 text-left"
                >
                    <span class="font-medium text-[#fafafa]">Table of Contents</span>
                    <span class="text-[#71717a]">{{ tocOpen() ? '−' : '+' }}</span>
                </button>
                @if (tocOpen()) {
                    <nav class="mt-2 rounded-lg border border-white/[0.06] bg-[#18181b] p-4">
                        <ul class="space-y-2">
                            @for (item of post()!.toc; track item.id) {
                                <li>
                                    <a
                                        (click)="scrollToSection(item.id); $event.preventDefault()"
                                        [href]="'#' + item.id"
                                        class="block text-sm transition-colors"
                                        [class.text-[#3b82f6]]="activeHeading() === item.id"
                                        [class.text-[#71717a]]="activeHeading() !== item.id"
                                        [class.hover:text-[#a1a1aa]]="activeHeading() !== item.id"
                                        [style.padding-left.px]="(item.level - 2) * 16"
                                    >
                                        {{ item.text }}
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            </div>
        }

        <div class="mt-8 flex gap-8">
        @if (post()!.toc && post()!.toc!.length > 0) {
                <aside class="sticky top-24 hidden h-fit w-64 flex-shrink-0 lg:block">
                    <nav class="rounded-lg border border-white/[0.06] bg-[#18181b] p-4">
                        <h2 class="mb-3 text-xs font-semibold uppercase tracking-wider text-[#71717a]">
                            Table of Contents
                        </h2>
                        <ul class="space-y-2">
                            @for (item of post()!.toc; track item.id) {
                                <li>
                                    <a
                                        (click)="scrollToSection(item.id); $event.preventDefault()"
                                        [href]="'#' + item.id"
                                        class="block text-sm transition-colors"
                                        [class.text-[#3b82f6]]="activeHeading() === item.id"
                                        [class.text-[#71717a]]="activeHeading() !== item.id"
                                        [class.hover:text-[#a1a1aa]]="activeHeading() !== item.id"
                                        [style.padding-left.px]="(item.level - 2) * 16"
                                    >
                                        {{ item.text }}
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                </aside>
            }

            <div class="flex-1">
                <div
                    #contentRef
                    class="prose prose-invert max-w-none prose-headings:text-[#fafafa] prose-p:text-[#a1a1aa] prose-a:text-[#3b82f6] prose-a:no-underline hover:prose-a:underline prose-strong:text-[#fafafa] prose-code:rounded prose-code:bg-[#18181b] prose-code:px-1.5 prose-code:py-0.5 prose-code:text-sm prose-pre:rounded-lg prose-pre:border prose-pre:border-white/[0.06] prose-pre:bg-[#09090b] prose-img:rounded-lg prose-blockquote:border-l-[#3b82f6] prose-blockquote:text-[#a1a1aa] prose-li:text-[#a1a1aa]"
                    [innerHTML]="post()!.content"
                ></div>

                <div class="mt-12 border-t border-white/[0.06] pt-8">
                    <p class="text-sm font-medium text-[#71717a]">Share this post</p>
                    <div class="mt-3 flex gap-3">
                        <button
                            (click)="shareOnTwitter()"
                            class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/10 text-[#71717a] transition-colors hover:border-white/20 hover:text-[#fafafa]"
                            aria-label="Share on Twitter"
                        >
                            <lucide-icon [img]="icons.Twitter" [size]="18" />
                        </button>
                        <button
                            (click)="shareOnLinkedIn()"
                            class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/10 text-[#71717a] transition-colors hover:border-white/20 hover:text-[#fafafa]"
                            aria-label="Share on LinkedIn"
                        >
                            <lucide-icon [img]="icons.Linkedin" [size]="18" />
                        </button>
                        <button
                            (click)="copyLink()"
                            class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/10 text-[#71717a] transition-colors hover:border-white/20 hover:text-[#fafafa]"
                            aria-label="Copy link"
                        >
                            <lucide-icon [img]="icons.Link2" [size]="18" />
                        </button>
                    </div>
                </div>
            </div>
        </div>

        @if (prevPost() || nextPost()) {
            <nav class="mt-16 grid grid-cols-1 gap-4 border-t border-white/[0.06] pt-8 sm:grid-cols-2">
                @if (prevPost()) {
                    <a
                        [routerLink]="['/blog', prevPost()!.slug]"
                        class="group rounded-lg border border-white/[0.06] p-4 transition-colors hover:border-white/[0.12]"
                    >
                        <span class="text-xs font-medium text-[#71717a]">← Previous</span>
                        <p class="mt-1 font-medium text-[#fafafa] transition-colors group-hover:text-[#3b82f6]">
                            {{ prevPost()!.title }}
                        </p>
                    </a>
                } @else {
                    <div></div>
                }

                @if (nextPost()) {
                    <a
                        [routerLink]="['/blog', nextPost()!.slug]"
                        class="group rounded-lg border border-white/[0.06] p-4 text-right transition-colors hover:border-white/[0.12]"
                    >
                        <span class="text-xs font-medium text-[#71717a]">Next →</span>
                        <p class="mt-1 font-medium text-[#fafafa] transition-colors group-hover:text-[#3b82f6]">
                            {{ nextPost()!.title }}
                        </p>
                    </a>
                }
            </nav>
        }
    </article>
}
