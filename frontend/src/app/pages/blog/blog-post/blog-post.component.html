@if (isLoading()) {
    <section class="section-block mx-auto max-w-4xl px-6 py-20">
        <div class="animate-pulse space-y-8">
            <div class="h-8 w-32 rounded bg-[#282828]"></div>
            <div class="h-12 w-3/4 rounded bg-[#282828]"></div>
            <div class="h-6 w-1/2 rounded bg-[#282828]"></div>
            <div class="aspect-video rounded-lg bg-[#282828]"></div>
            <div class="space-y-4">
                <div class="h-4 w-full rounded bg-[#282828]"></div>
                <div class="h-4 w-5/6 rounded bg-[#282828]"></div>
                <div class="h-4 w-4/6 rounded bg-[#282828]"></div>
            </div>
        </div>
    </section>
} @else if (error()) {
    <section class="section-block mx-auto max-w-4xl px-6 py-20 text-center">
        <div class="rounded-md border border-[#ea6962]/30 bg-[#282828] p-12">
            <p class="text-[#ea6962]">{{ error() }}</p>
            <a routerLink="/blog" class="mt-4 inline-flex h-10 items-center gap-2 rounded-md border border-white/10 px-5 text-sm font-medium text-[#d4be98] transition-colors hover:border-white/20 hover:text-[#d4be98]">
                <lucide-icon [img]="icons.ArrowLeft" [size]="16" />
                Back to Blog
            </a>
        </div>
    </section>
} @else if (post()) {
    <article class="section-block mx-auto max-w-7xl px-6 py-20">
        <div class="post-layout">
            @if (tocItems().length > 0) {
                <aside class="post-toc-column">
                    <nav class="toc-shell p-0" aria-label="Table of contents">
                        <h2 class="mb-4 pl-2 text-sm font-semibold uppercase tracking-wider text-[#928374]">
                            Table of Contents
                        </h2>
                        <ul class="space-y-2.5">
                            @for (item of tocItems(); track item.id) {
                                <li>
                                    <a
                                        (click)="scrollToSection(item.id); $event.preventDefault()"
                                        [href]="'#' + item.id"
                                        class="toc-link"
                                        [class.toc-link-active]="activeHeading() === item.id"
                                        [style.padding-left.px]="(item.level - 2) * 16"
                                        [attr.aria-current]="activeHeading() === item.id ? 'true' : null"
                                    >
                                        {{ item.text }}
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                </aside>
            }

            <div class="post-main-column">
                <a
                    routerLink="/blog"
                    class="inline-flex h-10 items-center gap-2 rounded-md border border-white/10 px-4 text-sm font-medium text-[#d4be98] transition-colors hover:border-white/20 hover:text-[#d4be98]"
                >
                    <lucide-icon [img]="icons.ArrowLeft" [size]="16" />
                    Back to Blog
                </a>

                <header class="post-header mt-8">
                    <p class="post-kicker">Article</p>

                    <h1 class="post-title text-3xl font-semibold tracking-tight text-[#d4be98] sm:text-4xl lg:text-5xl">
                        {{ post()!.title }}
                    </h1>

                    <div class="post-meta mt-5 flex flex-wrap items-center gap-4 text-sm text-[#928374]">
                        <span class="post-meta-item">
                            <lucide-icon [img]="icons.Calendar" [size]="14" />
                            <time [attr.datetime]="post()!.date">{{ post()!.date | date: 'mediumDate' }}</time>
                        </span>
                    </div>

                    @if (post()!.tags.length) {
                        <ul class="post-tags mt-5" aria-label="Post tags">
                            @for (tag of post()!.tags; track tag) {
                                <li>
                                    <span class="post-tag">{{ tag }}</span>
                                </li>
                            }
                        </ul>
                    }
                </header>

                @if (tocItems().length > 0) {
                    <div class="mt-8 lg:hidden">
                        <button
                            (click)="toggleToc()"
                            class="toc-mobile-toggle"
                            [attr.aria-expanded]="tocOpen()"
                            [attr.aria-controls]="tocPanelId"
                        >
                            <span class="toc-mobile-toggle-label">Table of Contents</span>
                            <span class="toc-mobile-toggle-icon" [class.toc-mobile-toggle-icon-open]="tocOpen()">
                                <lucide-icon [img]="icons.ChevronDown" [size]="17" />
                            </span>
                        </button>
                        @if (tocOpen()) {
                            <nav [id]="tocPanelId" class="toc-shell mt-3 p-0" aria-label="Table of contents">
                                <ul class="space-y-2.5">
                                    @for (item of tocItems(); track item.id) {
                                        <li>
                                            <a
                                                (click)="scrollToSection(item.id); $event.preventDefault()"
                                                [href]="'#' + item.id"
                                                class="toc-link"
                                                [class.toc-link-active]="activeHeading() === item.id"
                                                [style.padding-left.px]="(item.level - 2) * 16"
                                                [attr.aria-current]="activeHeading() === item.id ? 'true' : null"
                                            >
                                                {{ item.text }}
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </nav>
                        }
                    </div>
                }

                <div class="mt-8" #contentContainer>
                    @if (post()!.coverImage) {
                        <div class="mb-8 aspect-[16/8.8] overflow-hidden rounded-lg border border-white/[0.06] bg-[#282828]">
                            <img
                                [src]="post()!.coverImage"
                                [alt]="post()!.title"
                                class="h-full w-full object-cover"
                            />
                        </div>
                    }

                    <div class="markdown-content prose prose-invert max-w-none prose-headings:text-[#d4be98] prose-p:text-[#928374] prose-a:text-[#7daea3] prose-strong:text-[#d4be98] prose-code:text-[#d8a657] prose-pre:bg-[#32302f] prose-pre:text-[#d4be98]">
                        <markdown [data]="post()!.content" [disableSanitizer]="true"></markdown>
                    </div>

                    <div class="mt-12 border-t border-white/[0.06] pt-8">
                        <p class="text-sm font-medium text-[#928374]">Share this post</p>
                        <div class="mt-3 flex gap-3">
                            <button
                                (click)="shareOnLinkedIn()"
                                class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/10 text-[#d4be98] transition-colors hover:border-white/20 hover:text-[#d4be98]"
                                aria-label="Share on LinkedIn"
                            >
                                <lucide-icon [img]="icons.Linkedin" [size]="18" />
                            </button>
                            <button
                                (click)="copyLink()"
                                class="inline-flex h-10 w-10 items-center justify-center rounded-md border border-white/10 text-[#d4be98] transition-colors hover:border-white/20 hover:text-[#d4be98]"
                                aria-label="Copy link"
                            >
                                <lucide-icon [img]="icons.Link2" [size]="18" />
                            </button>
                        </div>
                    </div>
                </div>

                @if (prevPost() || nextPost()) {
                    <nav class="mt-16 grid grid-cols-1 gap-4 border-t border-white/[0.06] pt-8 sm:grid-cols-2">
                        @if (prevPost()) {
                            <a
                                [routerLink]="['/blog', prevPost()!.slug]"
                                class="group rounded-lg border border-white/[0.06] p-4 transition-colors hover:border-white/[0.12]"
                            >
                                <span class="text-xs font-medium text-[#928374]">← Previous</span>
                                <p class="mt-1 font-medium text-[#d4be98] transition-colors group-hover:text-[#7daea3]">
                                    {{ prevPost()!.title }}
                                </p>
                            </a>
                        } @else {
                            <div></div>
                        }

                        @if (nextPost()) {
                            <a
                                [routerLink]="['/blog', nextPost()!.slug]"
                                class="group rounded-lg border border-white/[0.06] p-4 text-right transition-colors hover:border-white/[0.12]"
                            >
                                <span class="text-xs font-medium text-[#928374]">Next →</span>
                                <p class="mt-1 font-medium text-[#d4be98] transition-colors group-hover:text-[#7daea3]">
                                    {{ nextPost()!.title }}
                                </p>
                            </a>
                        }
                    </nav>
                }
            </div>
        </div>
    </article>
}
