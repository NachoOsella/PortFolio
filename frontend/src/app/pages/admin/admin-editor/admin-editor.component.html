@if (isLoading()) {
    <section class="mx-auto max-w-6xl px-6 py-20">
        <div class="animate-pulse space-y-6">
            <div class="h-12 rounded bg-[#282828]"></div>
            <div class="h-12 rounded bg-[#282828]"></div>
            <div class="h-64 rounded bg-[#282828]"></div>
        </div>
    </section>
} @else {
    <section class="mx-auto max-w-6xl px-6 py-10">
        <div class="mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <a
                routerLink="/admin"
                class="btn-secondary"
            >
                <lucide-icon [img]="icons.ArrowLeft" [size]="16" />
                Back to Dashboard
            </a>

            <div class="flex gap-3">
                <button
                    (click)="save(false)"
                    [disabled]="isSaving()"
                    class="btn-secondary"
                >
                    <lucide-icon [img]="icons.Save" [size]="16" />
                    Save Draft
                </button>

                <button
                    (click)="save(true)"
                    [disabled]="isSaving()"
                    class="btn-primary"
                >
                    <lucide-icon [img]="icons.Send" [size]="16" />
                    Publish
                </button>
            </div>
        </div>

        @if (saveStatus() !== 'idle') {
            <div
                class="mb-6 rounded-lg border p-4"
                [class.border-green-500/20]="saveStatus() === 'success'"
                [class.bg-green-500/10]="saveStatus() === 'success'"
                [class.border-red-500/20]="saveStatus() === 'error'"
                [class.bg-red-500/10]="saveStatus() === 'error'"
            >
                <p
                    [class.text-green-400]="saveStatus() === 'success'"
                    [class.text-red-400]="saveStatus() === 'error'"
                >
                    {{ saveMessage() }}
                </p>
            </div>
        }

        <div class="grid grid-cols-1 gap-6 lg:grid-cols-5">
            <!-- Editor Column (60%) -->
            <div class="lg:col-span-3">
                <div class="space-y-5">
                    <div>
                        <label for="title" class="block text-sm font-medium text-[#928374]">Title</label>
                        <input
                            type="text"
                            id="title"
                            [(ngModel)]="form().title"
                            (blur)="generateSlug()"
                            class="mt-2 block h-11 w-full rounded-md border border-white/10 bg-transparent px-4 text-lg text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none"
                            [class.border-red-500]="errors()['title']"
                            placeholder="Post title"
                        />
                        @if (errors()['title']) {
                            <p class="mt-1 text-sm text-red-400">{{ errors()['title'] }}</p>
                        }
                    </div>

                    <div class="grid grid-cols-1 gap-5 sm:grid-cols-2">
                        <div>
                            <label for="slug" class="block text-sm font-medium text-[#928374]">Slug</label>
                            <input
                                type="text"
                                id="slug"
                                [(ngModel)]="form().slug"
                                [disabled]="isEditMode()"
                                class="mt-2 block h-11 w-full rounded-md border border-white/10 bg-transparent px-4 text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none disabled:opacity-50"
                                [class.border-red-500]="errors()['slug']"
                                placeholder="post-slug"
                            />
                            @if (errors()['slug']) {
                                <p class="mt-1 text-sm text-red-400">{{ errors()['slug'] }}</p>
                            }
                        </div>

                        <div>
                            <label for="date" class="block text-sm font-medium text-[#928374]">Date</label>
                            <input
                                type="date"
                                id="date"
                                [(ngModel)]="form().date"
                                class="mt-2 block h-11 w-full rounded-md border border-white/10 bg-transparent px-4 text-[#d4be98] transition-colors focus:border-[#7daea3] focus:outline-none"
                                [class.border-red-500]="errors()['date']"
                            />
                            @if (errors()['date']) {
                                <p class="mt-1 text-sm text-red-400">{{ errors()['date'] }}</p>
                            }
                        </div>
                    </div>

                    <div>
                        <label for="excerpt" class="block text-sm font-medium text-[#928374]">Excerpt</label>
                        <textarea
                            id="excerpt"
                            [(ngModel)]="form().excerpt"
                            rows="2"
                            class="mt-2 block w-full resize-none rounded-md border border-white/10 bg-transparent px-4 py-3 text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none"
                            [class.border-red-500]="errors()['excerpt']"
                            placeholder="Brief description of the post..."
                        ></textarea>
                        @if (errors()['excerpt']) {
                            <p class="mt-1 text-sm text-red-400">{{ errors()['excerpt'] }}</p>
                        }
                    </div>

                    <div>
                        <label for="tags" class="block text-sm font-medium text-[#928374]">Tags (comma-separated)</label>
                        <input
                            type="text"
                            id="tags"
                            [(ngModel)]="form().tags"
                            class="mt-2 block h-11 w-full rounded-md border border-white/10 bg-transparent px-4 text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none"
                            placeholder="typescript, angular, nodejs"
                        />
                    </div>

                    <div>
                        <label for="coverImage" class="block text-sm font-medium text-[#928374]">Cover Image URL (optional)</label>
                        <input
                            type="text"
                            id="coverImage"
                            [(ngModel)]="form().coverImage"
                            class="mt-2 block h-11 w-full rounded-md border border-white/10 bg-transparent px-4 text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none"
                            placeholder="/images/blog/cover.webp"
                        />
                    </div>

                    <div class="flex-1">
                        <label for="content" class="block text-sm font-medium text-[#928374]">
                            Content
                            <span class="ml-2 text-[#928374]">{{ wordCount() }} words</span>
                        </label>
                        <textarea
                            id="content"
                            [(ngModel)]="form().content"
                            rows="20"
                            class="mt-2 block w-full resize-none rounded-md border border-white/10 bg-transparent px-4 py-3 font-mono text-sm text-[#d4be98] placeholder:text-[#928374] transition-colors focus:border-[#7daea3] focus:outline-none"
                            [class.border-red-500]="errors()['content']"
                            placeholder="Write your post in Markdown..."
                        ></textarea>
                        @if (errors()['content']) {
                            <p class="mt-1 text-sm text-red-400">{{ errors()['content'] }}</p>
                        }
                    </div>
                </div>
            </div>

            <!-- Preview Column (40%) -->
            <div class="lg:col-span-2">
                <div class="sticky top-6">
                    <h3 class="mb-3 text-sm font-semibold uppercase tracking-wider text-[#928374]">Preview</h3>
                    <div class="max-h-[calc(100vh-200px)] overflow-y-auto rounded-lg border border-white/[0.06] bg-[#282828] p-5">
                        <div
                            class="prose prose-invert max-w-none prose-headings:text-[#d4be98] prose-p:text-[#928374] prose-a:text-[#7daea3] prose-strong:text-[#d4be98] prose-code:text-[#d8a657] prose-pre:bg-[#32302f] prose-pre:text-[#d4be98]"
                        >
                            <markdown [data]="form().content" [disableSanitizer]="true"></markdown>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}
